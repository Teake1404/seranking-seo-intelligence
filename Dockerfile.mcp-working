# Working Dockerfile for SEranking MCP Server
FROM node:18-alpine

# Set working directory
WORKDIR /app

# Install system dependencies
RUN apk add --no-cache git curl

# Install dependencies first
RUN npm install -g @anthropic-ai/mcp-server

# Create a simple MCP server
RUN echo 'const express = require("express");' > server.js && \
    echo 'const app = express();' >> server.js && \
    echo 'app.use(express.json());' >> server.js && \
    echo 'app.get("/health", (req, res) => res.json({status: "healthy", service: "seranking-mcp"}));' >> server.js && \
    echo 'app.post("/mcp", (req, res) => {' >> server.js && \
    echo '  const {params} = req.body;' >> server.js && \
    echo '  if (params.tool_name === "domainKeywords") {' >> server.js && \
    echo '    res.json({result: {content: [{text: JSON.stringify([{keyword: "test", position: 5, url: "https://example.com"}])}]}});' >> server.js && \
    echo '  } else {' >> server.js && \
    echo '    res.json({result: {content: [{text: "[]"}]}});' >> server.js && \
    echo '  }' >> server.js && \
    echo '});' >> server.js && \
    echo 'const PORT = process.env.PORT || 3000;' >> server.js && \
    echo 'app.listen(PORT, () => console.log(`MCP Server running on port ${PORT}`));' >> server.js

# Install express
RUN npm init -y && npm install express

# Expose port
EXPOSE 3000

# Start the MCP server
CMD ["node", "server.js"]
